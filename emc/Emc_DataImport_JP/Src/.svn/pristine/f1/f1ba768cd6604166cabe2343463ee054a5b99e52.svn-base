<?php
/*
* @incident_boad.php
*
* @create 2020/02/20 KBS Tam.nv
* @update
*/
require('portal_incident_boad_proc.php');
?>
<div class="row">
    <div class="col-md-6">
        <?php require('info_form.php')?>
        <div class="title text-yellow mar-tl-10">
            <?php echo $arrText['PORTAL_INCIDENT_TEXT_011']?>
        </div>
        <div class="t-row">
            <div class="select-container right-100 in-line">
                <select class="sl-boad">
                    <option value="boad1">機関カテゴリ</option>
                    <option value="boad2">情報カテゴリ</option>
                </select>
            </div>
            <div class="in-line">
                <span class="text-white"
                <?php echo $arrText['PORTAL_INCIDENT_TEXT_012']?> </span>
                <input type="checkbox" class="right-100" name="without_com" id="without_com">
            </div>
            <div class="in-line col-right">
                <button class="tbtn tbtn-none" onclick="
                        loadModalAnnonEdit(0,<?php echo @$arrIncident[0]['INCIDENT_CASE_NO']?>)" >
                    <?php echo $arrText['PORTAL_INCIDENT_TEXT_013']?>
                </button>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="title text-yellow">
            <?php echo $arrText['PORTAL_INCIDENT_TEXT_002']?>
        </div>
        <div class="incident-reg">
            <?php require('incident_case_form.php') ?>
        </div>
        <div class="row mar-tl-10">
            <div class="col-md-6">
                <div class="title text-yellow ">
                    <?php echo $arrText['PORTAL_INCIDENT_TEXT_008']?>
                </div>
            </div>
            <div class="col-md-6 text-right">
                <button class="tbtn tbtn-none load-modal"
                        href="request_edit.php" onclick="
                        loadModalAnnonEdit(0,<?php echo @$arrIncident[0]['INCIDENT_CASE_NO']?>)" >
                    <?php echo $arrText['PUBLIC_BUTTON_001']?>
                </button>
            </div>
        </div>
        <div class="cont-requests">
            <div class="t-row">
                <div class="col-md-6 title"><?php echo $arrText['PORTAL_INCIDENT_TEXT_009']?></div>
                <div class="col-md-6 title"><?php echo $arrText['PORTAL_INCIDENT_TEXT_010']?></div>
            </div>
            <div class="info-request">
                <?php require ('incident_request_form.php')?>
            </div>
        </div>
    </div>
</div>
<div class="cont-boad1">
    <table class="blueTable top-10">
        <thead>
        <tr>
            <?php
            foreach ($arrInsCategory as $intKey => $arrCat){
                echo '<th class="bg-'.$arrColorBgArr[$intKey].'">'
                    .$arrCat['INST_CATEGORY_NAME'.$strEndLang].'</th>';
            }
            ?>
        </tr>
        </thead>
        <tbody>
        <tr>
            <?php
            foreach ($arrInsCategory as $intKey => $arrCat){
                echo '<td>';
                echo '<div class="cont-ticker">';
                if(@$arrInfoData[$arrCat['INST_CATEGORY_NO']]){
                    foreach ($arrInfoData[$arrCat['INST_CATEGORY_NO']] as $cageNo =>  $arrItem){
                        echo '<div class="ticker bg-'.$arrColorBgArr[$intKey].'">';
                        echo '<div class="row-no-gutters">';
                        echo '<div class="col-md-6 title">'.@$arrCompany[$cageNo].'</div>';
                        echo '<div class="col-md-6 text-right"><img src="img/sticker-pink.jpg"></div>';
                        echo '</div>';
                        echo '<div ><span class="label-100">更新日時</span><span>タイトル</span></div>';
                        foreach ($arrItem as $arriInfoOfCom){
                            $strTitle = $arriInfoOfCom['TITLE'.$strEndLang];
                            if(!$strTitle){
                                $intUntra = 1;
                                if(!$objLoginUserInfo->intLanguageType){
                                    $strTitle = $arriInfoOfCom['TITLE_ENG'];
                                }else{
                                    $strTitle = $arriInfoOfCom['TITLE__JPN'];
                                }
                            }
                            echo '<div>';
                            echo '<span class="label-100">';
                            echo  date('m/d H:i:s',strtotime($arriInfoOfCom['UP_DATE'])).'</span>';
                            echo '<span>';
                            echo '<a href="#" data-toggle="tooltip" title="'.$strTitle.'" 
                                    onclick="loadModal(\'information_view.php\')" 
                                    class="tl-red-boad title-info">'.$strTitle.'</a>';
                            echo '</span>';
                            echo '</div>';
                        }
                        echo '</div>';
                    }
                }
                echo '</div>';
                echo '</td>';
            }
            ?>
        </tr>
        <tr class="tickers">
            <?php
            foreach ($arrInsCategory as $intKey => $arrCat){
                echo '<td>';
                if(@$arrInfoNotReg[$arrCat['INST_CATEGORY_NO']]){
                    foreach ($arrInfoNotReg[$arrCat['INST_CATEGORY_NO']] as $cageNo =>  $arrItem){
                        echo '<div class="ticker bg-'.$arrColorBgArr[$intKey].'">';
                        echo '<div class="row-no-gutters">';
                        echo '<div class="col-md-6 title">'.@$arrCompany[$cageNo].'</div>';
                        echo '<div class="col-md-6 text-right"><img src="img/sticker-white.jpg"></div>';
                        echo '</div>';
                        echo '<div >
                                <span class="label-100">'.$arrText['PORTAL_INCIDENT_TEXT_014'].'</span>
                                <span>'.$arrText['PORTAL_INCIDENT_TEXT_015'].'</span></div>';
                        foreach ($arrItem as $arriInfoOfCom){
                            $strTitle = $arriInfoOfCom['TITLE'.$strEndLang];
                            if(!$strTitle){
                                $intUntra = 1;
                                if(!$objLoginUserInfo->intLanguageType){
                                    $strTitle = $arriInfoOfCom['TITLE_ENG'];
                                }else{
                                    $strTitle = $arriInfoOfCom['TITLE__JPN'];
                                }
                            }
                            echo '<div>';
                            echo '<span class="label-100">
                                    '.date('m/d H:i:s',strtotime($arriInfoOfCom['UP_DATE'])).
                                    '</span>';
                            echo '<span> <a href="#" data-toggle="tooltip" 
                                    title="'.$strTitle.'" onclick="loadModal(\'information_view.php\')" 
                                    class="tl-red-boad title-info">'.$strTitle.'</a></span>';
                            echo '</div>';
                        }
                        echo '</div>';
                    }
                }

                echo '</td>';
            }
            ?>
        </tr>
        </tbody>
    </table>
</div>
<div class="cont-boad2">
    <table class="blueTable top-20">
        <thead>
        <tr>
            <?php
            foreach ($arrInsCategory as $intKey => $arrCat){
                echo '<th class="bg-'.$arrColorBgArr[$intKey].'">'.
                    $arrCat['INST_CATEGORY_NAME'.$strEndLang].'</th>';
            }
            ?>
        </tr>
        </thead>
        <tbody>
        <tr id="long_form">
            <?php
            require ('incident_boad_info_long_form.php');
            ?>
        </tr>
        </tbody>
    </table>
</div>
<script>
    $('.cont-boad2').hide();

    $('.sl-boad').on('change', function() {

        if(this.value == 'boad1'){
            $('.cont-boad1').show();
            $('.cont-boad2').hide();
        }else{
            $('.cont-boad1').hide();
            $('.cont-boad2').show();
        }
    });
    showTitle();

    function showTitle(){
        $('.title-info').each(function(){
            var widthSc = screen.width;
            var heighSc = screen.height;
            var tit = this.title;
            if(widthSc == '1920' && heighSc == '1080'){
                var strTit = tit.substring(0,<?php echo FHD_TITLE_WORD_COUNT ?>);
            }else{
                strTit = tit.substring(0,<?php echo TITLE_WORD_COUNT ?>);
            }
            $(this).html(strTit);
        });
    }

</script>
