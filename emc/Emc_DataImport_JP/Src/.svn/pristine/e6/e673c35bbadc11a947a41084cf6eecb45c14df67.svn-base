<?php
require_once ('incident_boad_ajax.php');
?>
<tr>
    <?php
    $arrInsId = array();
    foreach ($arrInsCategory as $intKey => $arrCat){
        $arrInsId[] = $arrCat['INST_CATEGORY_NO'];
        $intInsCateNo = $arrCat['INST_CATEGORY_NO'];
        echo '<td>';
        echo '<div class="col-ticker" id="col-ticker-'.$intInsCateNo.'">';
        echo '<div class="pink-ticker" id="pink-ticker-'.$intInsCateNo.'">';
        if(@$arrInfoData[$intInsCateNo]){
            foreach ($arrInfoData[$intInsCateNo] as $intCatNo =>  $arrItem){
                echo '<div class="ticker clearfix">';
                echo '<div class="row-no-gutters clearfix">';
                echo '<div class="col-md-11 title title-incident">'.@fncHtmlSpecialChars($arrCompany[$intCatNo]).'</div>';
                echo '<div class="col-md-1 text-right"><a href="#" onclick="pin('.$intInsCateNo.','.$arrItem[0]['COMPANY_NO'].')">
                                <img src="img/sticker-pink.jpg"></a>
                                </div>';
                echo '</div>';
                echo '<div class="sub-title-incident clearfix"> <span class="col-md-6">'.$arrText['PORTAL_INCIDENT_TEXT_014'].'</span><span class="col-md-6 ">'.$arrText['PORTAL_INCIDENT_TEXT_015'].'</span></div>';
                echo '<div class="cont-ticker">';
                foreach ($arrItem as $arrInfoOfCom){
                    $strTitle = $arrInfoOfCom['TITLE'.$strEndLang];
                    if(!$strTitle){
                        $intUntra = 1;
                        if(!$objLoginUserInfo->intLanguageType){
                            $strTitle = $arrInfoOfCom['TITLE_ENG'];
                        }else{
                            $strTitle = $arrInfoOfCom['TITLE_JPN'];
                        }
                    }
                    $dtmDateInfo = date('m/d H:i',strtotime($arrInfoOfCom['UP_DATE']));
                    echo '<div class="">';
                    echo '<span class="col-md-6 col-sm-6">'.$dtmDateInfo.'</span>';
                    echo '<span class="col-md-6 col-sm-6">';
                    echo '<a href="#" data-toggle="tooltip" data-placement="left" title="'.fncHtmlSpecialChars($strTitle).'" 
                                            onclick="loadModal(\'information_view.php\','.$arrInfoOfCom['INFORMATION_NO'].')" 
                                            class="tl-red-boad title-info">'.fncHtmlSpecialChars($strTitle).'</a>';
                    echo '</span>';
                    echo '</div>';
                }
                echo '</div>';
                echo '</div>';
            }
        }
        echo '</div>';

        echo '<div class="tickers" id="white-ticker-'.$intInsCateNo.'">';
        if(@$arrInfoNotReg[$intInsCateNo]){
            foreach ($arrInfoNotReg[$intInsCateNo] as $intCatNo =>  $arrItem){
                echo '<div class="ticker">';
                echo '<div class="row-no-gutters clearfix">';
                echo '<div class="col-md-11 title title-incident">'.@$arrCompany[$intCatNo].'</div>';
                echo '<div class="col-md-1 text-right"><a href="#" class="pin-white" onclick="pin('.$intInsCateNo.','.$arrItem[0]['COMPANY_NO'].',1)">
                                <img src="img/sticker-white.jpg"></a></div></div>';
                echo '<div class="sub-title-incident clearfix"> <span class="col-md-6">'.$arrText['PORTAL_INCIDENT_TEXT_014'].'</span><span class="col-md-6">'.$arrText['PORTAL_INCIDENT_TEXT_015'].'</span></div>';
                echo '<div class="cont-ticker">';
                foreach ($arrItem as $arrInfoOfCom){
                    $strTitle = $arrInfoOfCom['TITLE'.$strEndLang];
                    if(!$strTitle){
                        $intUntra = 1;
                        if(!$objLoginUserInfo->intLanguageType){
                            $strTitle = $arrInfoOfCom['TITLE_ENG'];
                        }else{
                            $strTitle = $arrInfoOfCom['TITLE_JPN'];
                        }
                    }
                    $dtmDateInfo = date('m/d H:i',strtotime($arrInfoOfCom['UP_DATE']));

                    echo '<div class="">';
                    echo '<span class="col-md-6 col-sm-6">'.$dtmDateInfo.'</span>';
                    echo '<span class="col-md-6 col-sm-6"> <a href="#" data-toggle="tooltip"  data-placement="left"
                                                title="'.fncHtmlSpecialChars($strTitle).'" onclick="loadModal(\'information_view.php\','.$arrInfoOfCom['INFORMATION_NO'].')" 
                                                class="tl-red-boad title-info">'.fncHtmlSpecialChars($strTitle).'</a></span>';
                    echo '</div>';
                }
                echo '</div>';
                echo '</div>';
            }
        }
        echo '</div>';
        echo '</div>';
        echo '</td>';
    }
    ?>
</tr>

<script>
    showTitle('title-info');
    function showTitle(className){
        $('.'+className).each(function(){
            // var widthSc = screen.width;
            var widthSc = screen.width;
            var heighSc = screen.height;

            var tit = this.title;
            if(widthSc >= 1920 && heighSc >= 1080){
                var strTit = tit.substring(0,<?php echo FHD_TITLE_WORD_COUNT ?>);
            }else{
                strTit = tit.substring(0,<?php echo TITLE_WORD_COUNT ?>);
            }
            $(this).html(strTit);
        });
    }



    $( document ).ready(function() {
        setHeigh();
    });


    function setHeigh(){
        var colTicker = 'col-ticker';
        doResizeTable(colTicker,48);

        var winHeight = $(window).height();
        var ticker = 'cont-ticker';

        if(winHeight < 700){
            doResize(ticker,12);
        }else{
            doResize(ticker,7);
        }


        var arrIds = <?php echo json_encode($arrInsId); ?>;
        $.each(arrIds, function( index, value ) {
            var colTickerHeight  = $('.col-ticker').height();
            var colPinkTickerHeight  = $('#pink-ticker-'+value).height();
            if(colPinkTickerHeight > colTickerHeight){
                $('#pink-ticker-'+value).css({'height': colTickerHeight -2 + 'px'});
                $('#pink-ticker-'+value).css({'overflow': 'hidden'});
                $('#white-ticker-'+value).css({'height': 0 + 'px'});
            }else{
                var colWhiteTickerHeight  = colTickerHeight - colPinkTickerHeight -2 ;
                $('#white-ticker-'+value).css({'height': colWhiteTickerHeight + 'px'});
            }

        });
    }

    window.onresize = function(event) {
        setHeigh();
    }

    $(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });


</script>